---
layout: post
title: ESP8266透传模式下发送数据长度的问题
date: 2016-11-15 16:09:55 +0800
categories:
- Linux
tags:
- ESP8266
---

ESP8266是一个串口WIFI模块，使用简单的AT指令，即可配置为透传模式。透传模式下，往串口发送的数据会“透明”得转发到网络服务器（一般常用TCP服务器）。

编写串口程序，使用ESP8266透传模式发送数据时，发现一个问题，在串口发送数据函数中，如果发送的数据长度比较小（大概100个字节左右），TCP服务器可以正常接收，但是当发送数据太长时（超过100个字节），TCP服务器不能正常接收数据（由于这些数据是一个完整的协议帧，因此不能分开发送，只能一次性完整发送）。通过串口调试工具发现，即使是比较长的数据，串口也能正常发送，因此考虑是ESP8266的问题导致不能一次性发送较多的数据。

查看ESP8266手册，里面提到“当ESP8266配置为透传模式时，需要提供硬件流控，否则当发送大量数据时，会造成数据丢失”。现在的串口一般都没有提供流控，因此考虑能否把ESP8266的波特率提高来解决这个问题（开始ESP8266配置的波特率为9600）。使用AT指令，把ESP8266配置为波特率230400、8数据位、1停止位、无校验、无流控。然后重新使用透传模式发送数据，发现即使是比较大的数据量，也能一次发送成功。

也可以尝试使用循环发送的方式，来发送大数据量数据。